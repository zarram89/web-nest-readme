# Личный проект «{{projectTitle}}»

* Студент: [{{userName}}]({{userProfile}}).
* Наставник: `Неизвестно`.

---

_Не удаляйте и не изменяйте папки и файлы:_
_`.editorconfig`, `.gitattributes`, `.gitignore`._

---

## Техническое задание
### Readme. Простой движок для блога

#### О проекте
«Readme» — это простой headless-движок для блога, построенный с помощью микросервисной архитектуры и современного фреймворка Nest.js. Проект состоит из нескольких микросервисов, каждый сервис решает одну задачу.

#### Общая концепция проекта
Вам предстоит разработать бэкенд для многопользовательского блога. Главная особенность сервиса — формат публикаций (их несколько) и возможность оформить подписку на обновления других пользователей. Подписка на пользователей влияет на контентную ленту пользователя.

#### Технические требования
Для разработки проекта применяется микросервисная архитектура. Студент самостоятельно определяет список микросервисов для приложения. Общее требование к сервисам: каждый сервис решает свою задачу.

Некоторые сервисы могут содержать свою базу данных. Решение по выбору базы данных и её необходимость для определённого микросервиса остаётся на усмотрение студента. В приложении могут использоваться следующие СУБД: MongoDB, PostgreSQL.

Для лучшего понимания работы проекта, студенту предоставляется полный набор вёрстки. Создавать из неё готовый фронтенд НЕ нужно. В рамках курса мы разрабатываем только бэкенд.

В корневой директории проекта размещается файл specification.md. Файл содержит все необходимые инструкции для запуска проекта.

Для разработки проекта используется актуальный LTS-релиз платформы Node.js. При необходимости студент может устанавливать дополнительные пакеты.

Код сервисов разрабатывается только на TypeScript. Все сервисы размещаются в монорепозитории. Для построения монорепозитория используется NX.

Техническое задание не определяет контракты и конкретные ресурсы разрабатываемого приложения. Решение по разделению приложения на сервисы, проектирование ресурсов API и другие архитектурные решения студент принимает самостоятельно.

#### Общий список сценариев
1.1. Регистрация новых пользователей.
1.2. Авторизация пользователей на основе JWT.
1.3. Создание новых публикаций в блоге разных видов: видео, текст, цитата, фото, ссылка.
1.4. Просмотр детальной информации о публикации.
1.5. Редактирование публикаций в блоге.
1.6. Удаление публикаций в блоге.
1.7. Загрузка изображений для публикации в блоге.
1.8. Комментирование публикаций в блоге.
1.9. Лайки к публикациям. Подсчёт количества лайков к публикациям.
1.10. Пагинация для публикаций.
1.11. Получение списка публикаций.
1.12. Получение списка публикаций с применением сортировки: по популярности, дате создания, по количеству лайков, по количеству комментариев.
1.13. Репост публикаций.
1.14. Лента пользователя.
1.15. Категоризация публикаций по тегам.
1.16. Рассылка почтовых уведомлений на email о появлении новых публикаций.
1.17. Поиск публикаций по названию.
1.18. Получение детальной информации о пользователе.
1.19. Смена пароля пользователя.
1.20. Подписка на обновления других пользователей.

#### Функциональность
**1. Регистрация и авторизация пользователей**
1.1. Регистрация доступна только анонимным клиентам.
1.2. Для регистрации клиент передаёт следующий набор информации:
* Электронная почта (обязательно). Используется в качестве логина. Адрес уникален.
* Имя пользователя (обязательно). Фамилия и имя пользователя. Мин: 3, Макс: 50.
* Пароль (обязательно). Мин: 6, Макс: 12.
* Аватар пользователя (опционально). Фотография. Макс: 500кб, jpg/png.
1.3. Валидация перед записью.
1.4. Хранение аватаров в ФС или БД.
1.5. Фиксация даты регистрации.
1.6. Хеширование паролей (bcrypt).
1.7. Возврат информации о пользователе после регистрации.
1.8. JWT авторизация.
1.9. Смена пароля (проверка текущего).
1.10. Детальная информация о пользователе (дата регистрации, кол-во публикаций, подписчиков, ID).

**2. Публикация постов в блоге**
2.1. CRUD только для авторизованных.
2.2. Редактирование/удаление только своих.
2.3. Удаление публикации -> удаление комментариев.
2.4. 5 видов публикаций: видео, текст, цитата, фото, ссылка.
2.5. Видео: Название (20-50), Ссылка (YouTube), Теги.
2.6. Текст: Название (20-50), Анонс (50-255), Текст (100-1024), Теги.
2.7. Цитата: Текст (20-300), Автор (3-50), Теги.
2.8. Фото: Фото (макс 1Мб, jpg/png), Теги.
2.9. Ссылка: Ссылка (URL), Описание (макс 300), Теги.
2.10. Автор определяется автоматически.
2.11. Дата создания и дата публикации.
2.12. Состояния: «Опубликована», «Черновик».
2.13. Репост: копирование, смена автора (оригинал сохраняется), обновление даты, признак «Репост».
2.14. Детальная информация о публикации.

**3. Список публикаций**
3.1. Список последних 25 публикаций (для всех).
3.2. Пагинация (следующие 25).
3.3. Фильтр по пользователю.
3.4. Правила пагинации сохраняются.
3.5. Только «Опубликовано».
3.6. Сортировка: Дата (default), Лайки, Обсуждаемые.
3.7. Состав: тип, лайки, комменты, дата, автор.
3.8. Фильтр по типу.
3.9. Список своих черновиков (для автора).
3.10. API Gateway агрегирует данные.
3.11. Фильтр по тегу.

**4. Моя лента**
4.1. Подписка на пользователей.
4.2. Лента из публикаций подписок.
4.3. Свои публикации тоже в ленте.
4.4. Сортировка/пагинация как в общем списке.
4.5. Подписка по ID.
4.6. Отписка.

**5. Лайки**
5.1. Только авторизованные.
5.2. Только для опубликованных.
5.3. Один лайк на публикацию. Toggle (поставить/забрать).

**6. Комментарии**
6.1. Только авторизованные.
6.2. Текст (10-300), ID публикации.
6.3. Автор и дата автоматически.
6.4. Удаление только своих.
6.5. Список комментариев (по 50).
6.6. Пагинация комментариев.

**7. Уведомления на email**
7.1. Рассылка о новых публикациях.
7.2. Всем пользователям.
7.3. Список новых с последней рассылки.
7.4. Оформление свободное.
7.5. Запуск по запросу (видимо, админский эндпоинт или крон).

**8. Поиск**
8.1. По заголовку.
8.2. До 20 результатов.

**9. API Gateway**
9.1. Агрегация данных.
9.2. Аутентификация/авторизация.

**Теги**
Одно слово, без пробелов, нижний регистр, уникальные, мин 3, макс 10 символов. Макс 8 тегов на пост.

---

## Задания

### Задание 1.1 (module1-task1)
Перед тем как приступить к написанию кода, потратим немного времени на базовое проектирование приложения. Вам предстоит внимательно прочитать техническое задание к выбранному проекту и подумать на какие микросервисы его можно разбить.

**Задача:**
1. Ознакомьтесь с ТЗ.
2. Декомпозируйте на микросервисы.
3. Подготовьте схему (Excalidraw/draw.io) -> `specification.md`.

### Задание 1.2 (module1-task2)
Инициализация монорепозитория NX.

**Задача:**
1. `npx create-nx-workspace@latest`
2. Stack: Node, Framework: Nest, Integrated monorepo.
3. App name: `account`.
4. Запустить `nx run account:serve`.

---

## Ход выполнения (Execution Log)

### 1. Проектирование архитектуры (module1-task1)

#### 1.1. Анализ технического задания
Первым шагом было внимательное изучение технического задания проекта "Readme". Основные выводы:
- Требуется микросервисная архитектура
- Необходимо поддерживать 5 типов публикаций (видео, текст, цитата, фото, ссылка)
- Система должна поддерживать авторизацию (JWT), комментарии, лайки, подписки
- Требуется email-рассылка уведомлений
- Используемые СУБД: MongoDB, PostgreSQL

#### 1.2. Декомпозиция на микросервисы
На основе анализа функциональных требований было принято решение разделить приложение на 4 микросервиса:

1.  **Account Service (`account`)**:
    *   **Ответственность**: Управление пользователями
    *   **Функции**: 
        - Регистрация и авторизация (JWT)
        - Хранение профилей пользователей (email, имя, пароль-хеш, аватар)
        - Управление подписками между пользователями
        - Смена пароля
    *   **База данных**: MongoDB (гибкая схема для профилей и подписок)

2.  **Blog Service (`blog`)**:
    *   **Ответственность**: Управление контентом
    *   **Функции**:
        - CRUD операции для публикаций всех типов
        - Управление комментариями к публикациям
        - Управление лайками
        - Система тегов
        - Логика репостов
        - Формирование ленты пользователя
        - Поиск по публикациям
    *   **База данных**: PostgreSQL (структурированные данные, сложные запросы для фидов и сортировок)

3.  **Notification Service (`notify`)**:
    *   **Ответственность**: Рассылка уведомлений
    *   **Функции**:
        - Email рассылка о новых публикациях
        - Формирование писем с обновлениями
    *   **База данных**: Не требуется (stateless) или небольшая БД для логирования (опционально)

4.  **API Gateway (`api-gateway`)**:
    *   **Ответственность**: Единая точка входа и оркестрация
    *   **Функции**:
        - Маршрутизация запросов к соответствующим сервисам
        - Централизованная аутентификация/авторизация (проверка JWT)
        - Агрегация данных из разных сервисов (например, пост + данные автора)
        - Единый API для фронтенда

#### 1.3. Создание диаграммы архитектуры
Архитектурная схема была создана в файле [`specification.md`](file:///d:/web/web-nest-readme/specification.md) с использованием Mermaid-диаграммы.

**Обоснование выбора Mermaid вместо Excalidraw/draw.io:**
- Mermaid позволяет хранить диаграммы в текстовом виде (версионный контроль)
- Автоматический рендеринг в GitHub и большинстве markdown-редакторов
- Легко редактировать и поддерживать
- Интегрируется с документацией

Диаграмма отображает:
- Взаимодействие клиента с API Gateway
- Коммуникацию между микросервисами
- Связи с базами данных
- Асинхронные события (например, уведомления о новых постах)

#### 1.4. Обновление документации
В файл [`Readme.md`](file:///d:/web/web-nest-readme/Readme.md) было добавлено:
- Полный текст технического задания (дословно)
- Описание всех заданий модуля 1
- Текущий раздел с подробным описанием хода выполнения

---

### 2. Инициализация NX workspace (module1-task2)

#### 2.1. Выбор инструментов
Для построения монорепозитория был выбран **NX** — современный инструмент для управления монорепозиториями с отличной поддержкой Nest.js.

**Преимущества NX:**
- Встроенная поддержка Nest.js
- Инкрементальная сборка и кеширование
- Генераторы кода
- Dependency graph
- Удобные команды для работы с несколькими проектами

#### 2.2. Инициализация workspace
Был выполнен следующий процесс инициализации:

**Команда:**
```bash
npx create-nx-workspace@latest project --preset=nest --appName=account --docker=false --nxCloud=skip --packageManager=npm
```

**Параметры команды:**
- `project` — имя воркспейса (соответствует требованиям автоматизации курса)
- `--preset=nest` — использование Nest.js пресета
- `--appName=account` — имя первого приложения (сервис пользователей)
- `--docker=false` — без автоматической генерации Dockerfile (добавим позже при необходимости)
- `--nxCloud=skip` — без подключения к Nx Cloud
- `--packageManager=npm` — использование npm в качестве пакетного менеджера

**Дополнительные выборы при инициализации:**
- Unit test runner: **Jest**
- ESLint: **Yes** (линтинг кода)
- Prettier: **Yes** (форматирование кода)

#### 2.3. Структура созданного проекта
После инициализации была создана следующая структура:
```
project/
├── apps/
│   └── account/              # Первый микросервис
│       ├── src/
│       │   ├── app/
│       │   └── main.ts
│       └── tsconfig.app.json
├── node_modules/
├── .nx/                      # Кеш NX
├── nx.json                   # Конфигурация NX
├── package.json              # Зависимости
├── tsconfig.base.json        # Базовая конфигурация TypeScript
└── README.md
```

#### 2.4. Проверка работоспособности
Для проверки корректности установки был запущен сервис `account`:

**Команда (из директории `project`):**
```bash
npx nx run account:serve
```

**Примечание:** Важно запускать команду из папки `project`, так как именно там находится NX workspace. Запуск из корня репозитория приведет к ошибке "The current directory isn't part of an Nx workspace".

**Результат:**
- ✅ Сервис успешно запустился
- ✅ Webpack скомпилировал приложение
- ✅ NestJS приложение слушает на порту 3000
- ✅ Все зависимости установлены корректно

#### 2.5. Следующие шаги
В дальнейшем будут созданы дополнительные микросервисы:
```bash
# Команды для создания остальных сервисов (будут выполнены позже)
npx nx g @nx/nest:app blog
npx nx g @nx/nest:app notify
npx nx g @nx/nest:app api-gateway
```

---

### Заключение по Module 1
Все задачи модуля 1 выполнены:
- ✅ Архитектура спроектирована и задокументирована
- ✅ NX workspace инициализирован
- ✅ Первый микросервис `account` создан и проверен
- ✅ Документация обновлена

**Файлы проекта:**
- [specification.md](file:///d:/web/web-nest-readme/specification.md) — архитектура и схема
- [Readme.md](file:///d:/web/web-nest-readme/Readme.md) — ТЗ и документация
- `project/` — NX workspace с микросервисом `account`

